var x=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var c=(u,d,e,t)=>{for(var i=t>1?void 0:t?k(d,e):d,s=u.length-1,h;s>=0;s--)(h=u[s])&&(i=(t?h(d,e,i):h(i))||i);return t&&i&&x(d,e,i),i};import{CustomElement as I,debounce as R,html as T,property as y,query as C}from"@papit/core";import{Engine as B}from"@papit/game-engine";import{InputEvents as L}from"@papit/game-input-events";import"@feedmolly/play-button";import"@feedmolly/music-button";import"@feedmolly/heart";var v=':host{overflow:hidden;position:relative;width:100%;height:100%;display:block}canvas,img.background{position:absolute;top:0;left:0}img.background{min-width:100%;height:100%}header{display:flex;position:relative;justify-content:flex-end;align-items:center;padding:1rem;gap:1rem}header div.score{box-sizing:border-box;font-size:1.5rem}footer{position:absolute;bottom:0;right:0;text-align:right;padding-right:1rem;font-size:.8rem;color:rgba(233,233,233,.633)}div.menu{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);width:400px;height:300px;display:none}div.menu img{position:absolute;top:0;left:0;z-index:1}div.menu play-button{position:absolute;z-index:2;top:50%;left:50%;transform:translate(-50%, -50%)}div.menu.end img.game-over{z-index:2;top:35%;left:50%;transform:translate(-50%, -50%)}div.menu.end play-button{position:absolute;z-index:2;top:65%;left:50%;transform:translate(-50%, -50%)}:host([mode=start]) div.menu.start{display:block}:host([mode=end]) div.menu.end{display:block}:host([hearts="0"]) feedmolly-heart{display:none}:host([hearts="1"]) feedmolly-heart+feedmolly-heart{display:none}:host([hearts="2"]) feedmolly-heart+feedmolly-heart+feedmolly-heart{display:none}';import{getlink as o,LoadImage as n}from"@papit/game-engine";import{Vector as M}from"@papit/game-vector";var r=class extends M{constructor(e){super(150+(e-300)*Math.random(),-200);this.index=Math.floor(Math.random()*r.items.length)%r.items.length,this.rotation=0,this.speed=(Math.random()*7+8)/10,this.rotationspeed=.01+Math.random()/100}static async load(){r.items.length>0||r.items.push({image:await n(o("/images/beef.png")),score:1},{image:await n(o("/images/bone.png")),score:-1},{image:await n(o("/images/can.png")),score:-1},{image:await n(o("/images/candy.png")),score:1},{image:await n(o("/images/carrot.png")),score:1},{image:await n(o("/images/chicken.png")),score:1},{image:await n(o("/images/egg.png")),score:1},{image:await n(o("/images/plastic-bag.png")),score:-1},{image:await n(o("/images/potato.png")),score:1},{image:await n(o("/images/sausage.png")),score:1},{image:await n(o("/images/water.png")),score:1})}get image(){return r.items[this.index].image}get score(){return r.items[this.index].score}update(e=0){this.rotation+=this.rotationspeed,this.y+=this.speed+e}draw(e){e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.drawImage(this.image,-this.image.width/2,-this.image.height/2),e.restore()}},l=r;l.items=[];import{getlink as p,LoadImage as f}from"@papit/game-engine";import{Vector as S}from"@papit/game-vector";import{debounce as E}from"@papit/core";var m=class extends S{constructor(e,t){super(e/2,t);this._mode="normal";this.resetMode=()=>{this.mode="normal"};this.resetMode=E(this.resetMode,400)}static async load(){m.images={miss:await f(p("/images/molly-miss-the-food400.png")),eat:await f(p("/images/molly-eat400.png")),normal:await f(p("/images/molly-normal400.png"))}}get mode(){return this._mode}set mode(e){e!=="normal"&&this.resetMode(),this._mode=e}get face(){return{x:this.x+60,y:this.y-130,r:35}}eat(e){e.score>0?this.mode="eat":this.mode="miss"}draw(e){let t=m.images[this.mode];e.drawImage(t,this.x-t.width/2,this.y-230)}drawBoundary(e){let t=this.face;e.beginPath(),e.arc(t.x,t.y,t.r,0,Math.PI*2),e.lineWidth=3,e.strokeStyle="orange",e.stroke()}};import{Vector as b}from"@papit/game-vector";var a=class extends I{constructor(){super();this.items=[];this.dragmolly=null;this.difficultiness=0;this.mode="start";this.score=0;this.hearts=3;this.handleplayclick=()=>{this.score=0,this.hearts=3,this.engine.loop(this.draw),this.setplay()};this.handlepress=()=>{let e=b.Subtract(this.events.position,this.molly);e.magnitude<=200&&(this.dragmolly=e)};this.handlerelease=e=>{this.dragmolly=null};this.setplay=()=>{this.mode="play",this.musicButton&&(this.musicButton.play=!0)};this.gameend=()=>{this.musicButton&&(this.musicButton.play=!1),this.items=[],this.engine.stop(),this.mode="end",this.molly.mode="miss",this.crySound.pause(),this.crySound.currentTime=0,this.crySound.play(),this.difficultiness=0};this.draw=()=>{if(this.mode!="play")return;this.difficultiness+=2e-5,this.difficultiness>10&&(this.difficultiness=10),this.engine.ctx.clearRect(0,0,this.engine.width,this.engine.height),this.time++;let e=performance.now();e-this.time>this.interval&&(this.interval=Math.random()*1e3+500,this.time=e,this.items.push(new l(this.engine.width))),this.dragmolly!==null&&this.molly.set(b.Subtract(this.events.position,this.dragmolly));let t=this.molly.face;for(let i=0;i<this.items.length;i++){let s=this.items[i];s.update(this.difficultiness),s.draw(this.engine.context);let h=b.Distance(s,t),w=!1;h<=t.r&&(this.molly.eat(s),w=!0,s.score>0?(this.score++,this.eatSound.pause(),this.eatSound.currentTime=0,this.eatSound.play()):this.hearts>0&&(this.hearts--,this.crySound.pause(),this.crySound.currentTime=0,this.crySound.play()));let g=s.y>this.engine.height+50&&s.score>0;(w||g)&&(g&&(this.molly.mode="miss"),this.items.splice(i,1),i--,g&&this.hearts>0&&(this.hearts--,this.crySound.pause(),this.crySound.currentTime=0,this.crySound.play()))}this.hearts<=0&&this.gameend(),this.molly.draw(this.engine.context)};this.interval=1e3,this.time=performance.now(),this.setplay=R(this.setplay),this.eatSound=new Audio("sounds/eat.mp3"),this.crySound=new Audio("sounds/cry.mp3")}async firstRender(){if(super.firstRender(),!this.shadowRoot)throw new Error("could not establish shadowRoot");this.engine=new B({query:"canvas",documentElemenet:this.shadowRoot}),this.events=new L(this.engine.canvas,{keyboard:void 0,touch:void 0,mouse:{pointerlock:void 0}}),this.molly=new m(this.engine.width,this.engine.height),this.events.on("up",this.handlerelease),this.events.on("down",this.handlepress),await l.load(),await m.load()}render(){return T`
      <img class="background" src="images/background.jpg" alt="game background" />
      <canvas>Your browser does not support html-canvas</canvas>
      <header>
        <div>
          <feedmolly-heart key="0" index="0"></feedmolly-heart>
          <feedmolly-heart key="1" index="1"></feedmolly-heart>
          <feedmolly-heart key="2" index="2"></feedmolly-heart>
        </div>
        <music-button></music-button>
        <div class="score">
          SCORE: <span>${this.score}</span>
        </div>
      </header>

      <footer>
        <p>Art & concept by Phượng Ngọc Đào, music & development by Henry Pap.</p>
      </footer>

      <div class="menu start">
        <img src="images/menu-background.png" alt="menu background" />
        <play-button @click="${this.handleplayclick}"></play-button>
      </div>

      <div class="menu end">
        <img src="images/menu-background.png" alt="menu background" />
        <img class="game-over" src="images/game-over.png" alt="game over" />
        <play-button @click="${this.handleplayclick}"></play-button>
      </div>
    `}};a.style=v,c([y({type:String,rerender:!1})],a.prototype,"mode",2),c([y({type:Number})],a.prototype,"score",2),c([y({type:Number})],a.prototype,"hearts",2),c([C("music-button")],a.prototype,"musicButton",2);if(!window.customElements)throw new Error("Custom Elements not supported");window.customElements.get("feedmolly-game")||window.customElements.define("feedmolly-game",a);export{a as Game};
