import{Vector as k}from"@papit/game-vector";import{Vector as E}from"@papit/game-vector";var p={1:"left",2:"wheel",3:"right"},m={pointerlock:{unadjustedMovement:!0}};var r=class extends EventTarget{constructor(e,t){super();this.pointerlocktimer=null;this.handlemousemove=e=>{if(document.pointerLockElement)this.position.add(e.movementX,e.movementY),this.movement.set(e.movementX,e.movementY);else{let t=this.position.x-e.clientX,n=this.position.y-e.clientY;this.position.set(e.clientX,e.clientY),this.movement.set(t,n)}this.dispatchEvent(new Event("move"))};this.handlemousedown=e=>{this.clicked=!0,this.click.start=performance.now(),this.click.end=null,e.target&&"button"in e.target&&(this.click.button=p[e.target.button]),this.dispatchEvent(new Event("down"))};this.handlemouseup=e=>{this.clicked=!1,this.click.end=performance.now(),this.click.button=null,this.dispatchEvent(new Event("up"))};this.handlepointersetup=e=>{if(document.pointerLockElement)return;let t=e.target,{clientX:n,clientY:a}=e,u=Math.max(0,1500-(performance.now()-this.lastpointerlock));this.position.set(n,a),this.pointerlocktimer&&clearTimeout(this.pointerlocktimer),this.pointerlocktimer=setTimeout(async()=>{var d;try{await t.requestPointerLock(this.setting.pointerlock)}catch(i){if(console.log("pointer lock error",i),i instanceof Error&&i.name==="NotSupportedError"&&(d=this.setting.pointerlock)!=null&&d.unadjustedMovement)return t.requestPointerLock()}},u)};this.handlepointerlockchange=e=>{this.lastpointerlock=performance.now(),document.pointerLockElement?(console.log("The pointer lock status is now locked"),document.addEventListener("mousemove",this.handlemousemove,{passive:!0})):(console.log("The pointer lock status is now unlocked"),document.removeEventListener("mousemove",this.handlemousemove,!1))};this.handlepointerlockerror=e=>{console.error("pointer lock failed",e)};this.position=E.Zero,this.movement=E.Zero,this.setting=t,this.lastpointerlock=performance.now()-1e3,this.clicked=!1,this.verbose=!1,this.click={start:null,end:null,button:null},t.pointerlock?(e.addEventListener("click",this.handlepointersetup),document.addEventListener("pointerlockchange",this.handlepointerlockchange,!1),document.addEventListener("pointerlockerror",this.handlepointerlockerror,!1)):document.addEventListener("mousemove",this.handlemousemove,{passive:!0}),e.addEventListener("mousedown",this.handlemousedown),e.addEventListener("mouseup",this.handlemouseup)}on(e,t,n){this.addEventListener(e,t,n)}addEventListener(e,t,n){super.addEventListener(e,t,n)}draw(e,t="black",n="rgba(0,0,0,0.1)",a=1){e.fillStyle=n,e.strokeStyle=t,e.lineWidth=a,e.beginPath(),e.arc(this.position.x,this.position.y,10,0,Math.PI*2),e.fill(),e.stroke()}};import{logscreen as f}from"@papit/game-engine";var l=class extends EventTarget{constructor(){super();this.handlekeydown=e=>{let t=(e.key||e.code).toLowerCase();this.keys[t]||(this.keys[t]={clicked:!1}),this.keys[t].clicked===!1&&(this.keys[t].start=performance.now()),this.keys[t].clicked=!0,this.keys[t].stop=null,this.verbose&&f("keyup",t,this.keys[t]),this.dispatchEvent(new CustomEvent(`${t}-down`,{detail:{name:t,value:this.keys[t]}})),this.dispatchEvent(new CustomEvent(t,{detail:{name:t,value:this.keys[t]}}))};this.handlekeyup=e=>{let t=(e.key||e.code).toLowerCase();if(!this.keys[t])throw new Error("keyup event fired but no key registered: "+t);this.keys[t].clicked=!1,this.keys[t].stop=performance.now(),this.verbose&&f("keyup",t,this.keys[t]),this.dispatchEvent(new CustomEvent(`${t}-up`,{detail:{name:t,value:this.keys[t]}})),this.dispatchEvent(new CustomEvent(t,{detail:{name:t,value:this.keys[t]}}))};this.keys={},this.verbose=!1,document.addEventListener("keydown",this.handlekeydown,{passive:!0}),document.addEventListener("keyup",this.handlekeyup)}on(e,t,n){this.addEventListener(e,t,n)}addEventListener(e,t,n){super.addEventListener(e,t,n)}key(e){return this.keys[e]}};import{Vector as c}from"@papit/game-vector";import{logscreen as g}from"@papit/game-engine";var v=class{constructor(s){this.position=c.Zero,this.movement=c.Zero,this.start=performance.now(),this.end=null,this.update(s)}get id(){return this.identifier}update(s){if(this.identifier=s.identifier,this.screenX=s.screenX,this.screenY=s.screenY,this.clientX=s.clientX,this.clientY=s.clientY,this.pageX=s.pageX,this.pageY=s.pageY,this.radiusX=s.radiusX,this.radiusY=s.radiusY,this.rotationAngle=s.rotationAngle,this.force=s.force,this.target=s.target,this.position===null)this.movement=c.Zero,this.position=new c(this.clientX,this.clientY);else{let e=this.position.copy();this.position.set(this.clientX,this.clientY),this.movement=this.position.Sub(e)}}release(){return this.end=performance.now(),this}},h=class extends EventTarget{constructor(e){super();this.handletouchstart=e=>{var a,u;this.changedTouches=[];let t=(a=this.mouse)==null?void 0:a.id;for(let d of e.changedTouches){let i=this.touchChange(d);this.mouse=i,this.position.set(i.position),this.movement.set(i.movement)}let n=t!==((u=this.mouse)==null?void 0:u.id);n&&this.dispatchEvent(new Event("last-down")),this.verbose&&g("touch start",n),this.dispatchEvent(new Event("down"))};this.handletouchend=e=>{this.changedTouches=[];for(let t of e.changedTouches){let n=this.touchChange(t);n.release(),delete this.touches[n.id],n===this.mouse&&(this.position.set(n.position),this.movement.set(n.movement),this.mouse=null,this.dispatchEvent(new Event("last-up")))}this.verbose&&g("touch end"),this.dispatchEvent(new Event("up"))};this.handletouchmove=e=>{this.changedTouches=[];for(let t of e.changedTouches){let n=this.touchChange(t);n===this.mouse&&(this.position.set(n.position),this.movement.set(n.movement),this.dispatchEvent(new Event("last-move")))}this.dispatchEvent(new Event("move"))};this.handletouchcancel=e=>{this.changedTouches=[];for(let t of e.changedTouches){let n=this.touchChange(t);n.release(),delete this.touches[n.id],n===this.mouse&&(this.mouse=null,this.dispatchEvent(new Event("last-up")))}this.position.set(0,0),this.movement.set(0,0),this.dispatchEvent(new Event("cancel"))};this.position=c.Zero,this.movement=c.Zero,this.mouse=null,this.touches={},this.changedTouches=[],this.verbose=!1,e.addEventListener("touchstart",this.handletouchstart),e.addEventListener("touchend",this.handletouchend),e.addEventListener("touchmove",this.handletouchmove,{passive:!0}),e.addEventListener("touchcancel",this.handletouchcancel)}on(e,t,n){this.addEventListener(e,t,n)}addEventListener(e,t,n){super.addEventListener(e,t,n)}touchChange(e){let t=e.identifier;return this.touches[t]?this.touches[t].update(e):this.touches[t]=new v(e),this.changedTouches.push(this.touches[t]),this.touches[t]}};var b=class extends EventTarget{constructor(e,t){super();this.pressing=!1;this.handledown=e=>{(e.target instanceof r||e.target instanceof h)&&(this.position=e.target.position,this.movement=e.target.movement,this.pressing=!0,this.dispatchEvent(new Event("mouse-down")))};this.handleup=e=>{(e.target instanceof r||e.target instanceof h)&&(this.position=e.target.position,this.movement=e.target.movement,this.pressing=!1,this.dispatchEvent(new Event("mouse-up")))};this.handlemove=e=>{(e.target instanceof r||e.target instanceof h)&&(this.position=e.target.position,this.movement=e.target.movement,this.dispatchEvent(new Event("mouse-move")))};this.settings=w(t),this.mouse=new r(e,this.settings.mouse),this.touch=new h(e),this.keyboard=new l,this.position=k.Zero,this.movement=k.Zero,this.verbose=!!this.settings.verbose,this.mouse.on("down",this.handledown),this.mouse.on("up",this.handleup),this.mouse.on("move",this.handlemove),this.touch.on("last-down",this.handledown),this.touch.on("last-up",this.handleup),this.touch.on("last-move",this.handlemove)}set verbose(e){this.mouse.verbose=e,this.keyboard.verbose=e,this.touch.verbose=e}key(e){return this.keyboard.keys[e]}onkey(e,t){this.keyboard.on(e,t)}on(e,t){switch(e){case"mouse-move":case"mouse-up":case"mouse-down":this.addEventListener(e,t);case"move":case"down":case"up":this.mouse.addEventListener(e,t),this.touch.addEventListener(e,t);case"cancel":this.touch.addEventListener(e,t);default:this.keyboard.on(e,t)}}};function w(o){return{...o||{},mouse:{...m,...(o==null?void 0:o.mouse)||{}}}}export{b as InputEvents};
