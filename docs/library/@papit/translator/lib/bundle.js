var w=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var f=(h,e,t,n)=>{for(var a=n>1?void 0:n?y(e,t):e,r=h.length-1,i;r>=0;r--)(i=h[r])&&(a=(n?i(e,t,a):i(a))||a);return n&&a&&w(e,t,a),a};import{ExtractSlotValue as v,CustomElement as E,html as x,property as T}from"@papit/core";var b=":host{padding:auto}";var g="pap-translation-change",m="pap-translation-added";var u=class{constructor(e={}){this.map=new Map;this.abortControllers=new Map;this.handleadd=async()=>{var e;if(this.map.size>0&&((e=this.current)==null?void 0:e.id)===void 0){let t=this.detect();if(t){let n=await this.change(t);if(!n){for(let a of this.map.keys())if(n=await this.change(a),n)break;n||console.error("[ERROR]: could not change to any available languages")}}else console.warn("[WARN]: could not detect any target language")}};this.set=e=>{var t;(t=e.translations)!=null&&t.meta?e.meta=e.translations.meta:e.meta||(e.meta={language:e.id,region:e.id}),this.map.set(e.id,e)};if(window.localization)return e.languages&&(window.localization.add(e.languages),e.selected&&window.localization.change(e.selected)),window.localization;window.addEventListener(m,this.handleadd),"DisplayNames"in Intl?this.displaynames=new Intl.DisplayNames(["en"],{type:"language"}):console.warn("Intl.DisplayNames is NOT supported in this browser."),e.languages&&(this.add(e.languages),e.selected&&this.change(e.selected)),window.localization=this}detect(){var r;if((r=this==null?void 0:this.current)!=null&&r.meta)return this.current.meta.language;let e=window.location.pathname.match(/\/([^/]+)/);if(e)if(this.displaynames){let i=this.displaynames.of(e[1]);if(i||i!==e[1])return e[1]}else return e[1];let t=window.localStorage.getItem("pap-translation");if(t)return t;let n=document.head.getAttribute("lang");if(n)return n;let a=navigator.language;if(a)return a}add(...e){e.forEach(t=>{t instanceof Array?t.forEach(this.set):this.set(t)}),window.dispatchEvent(new Event(m))}load(e){this.add(e),this.change(e.id)}async change(e){var r,i,p;let t=this.map.get(e);if(!t){for(let s of this.map.values())if(s.meta&&(s.meta.language===e||s.meta.region===e)){t=s;break}if(!t)return console.warn(`[ERROR] could not find the provided translation ${e}`),window.localStorage.removeItem("pap-translation"),!1}if(t.id===((r=this.current)==null?void 0:r.id))return!0;if(!t.translations&&t.url){if(this.abortControllers.has(t.url))return;let s=!1;try{let o=new AbortController;this.abortControllers.set(t.url,o);let l=await(await fetch(t.url,{signal:o.signal})).json();t.translations=l,this.set(t)}catch(o){this.map.delete(t.id),window.localStorage.removeItem("pap-translation"),console.error("[error] could not fetch translation",o),s=!0}finally{if(this.abortControllers.delete(t.url),s)return!1}}let n=(p=(i=this.current)==null?void 0:i.meta)==null?void 0:p.language;this.current=t,window.localStorage.setItem("pap-translation",t.id);let a=this.current.meta.language;return document.head.setAttribute("lang",a),window.dispatchEvent(new Event(g)),!0}subscribe(e){window.addEventListener(g,e)}unsubscribe(e){window.removeEventListener(g,e)}t(e,t={}){return this.translate(e,t)}translate(e,t={}){var p,s;let n=(t.scope?t.scope+".":"")+e,a=((s=(p=this.current)==null?void 0:p.translations)==null?void 0:s[n])||e;if(a===void 0&&e===void 0)return;let r=/{([^{}]+)}/g,i=a.match(r);return i&&i.forEach(o=>{let c=o.slice(1,-1);if(t.element){let l=t.element.getAttribute(c);console.log("variables",o,c,l),l&&(a=a.replace(o,l),t.element.dynamicAttributes.has(c)||t.element.dynamicAttributes.add(c))}else if(t.variables){let l=t.variables[c];l&&(a=a.replace(o,l))}}),a}};var d=class extends E{constructor(){super();this.dynamicAttributes=new Set;this.internal=!1;this.noupdate=!1;this.mutantobservercallback=(t,n)=>{if(this.internal){this.internal=!1;return}for(let a of t)a.type==="attributes"&&a.attributeName&&this.dynamicAttributes.has(a.attributeName)&&(this.internal=!0,this.updateText())};this.handleslotchange=t=>{if(t.target instanceof HTMLSlotElement){let n=v(t.target).join(" ").trim();this.key=n}};this.updateText=()=>{let t=this.localization.translate(this.key,{element:this,scope:this.scope});t&&(this.text=t,this.noupdate||this.requestUpdate(),this.internal=!1,this.noupdate=!1)};this.localization=new u,this.observer=new MutationObserver(this.mutantobservercallback),this.observer.observe(this,{attributes:!0})}get key(){return this._key}set key(t){typeof t=="string"?this._key=t:this._key="",this.updateText()}t(t,n){return this.localization.t(t,n)}get innerText(){return this.text}get innerHTML(){return this.text}get textContent(){return this.text}connectedCallback(){super.connectedCallback(),window.localization.subscribe(this.updateText)}disconnectedCallback(){super.disconnectedCallback(),window.localization.unsubscribe(this.updateText)}attributeChangedCallback(t,n,a){super.attributeChangedCallback(t,n,a),this.dynamicAttributes.has(t)&&this.updateText()}translateKey(t,n){if(n)for(let a in n)this.setAttribute(a,n[a]),this.dynamicAttributes.add(a);return this.key!==t&&(this.noupdate=!0,this.key=t),this.text}render(){return x`
      <span>${this.text}</span>
      <slot hidden style="display:none" @slotchange="${this.handleslotchange}"></slot>
    `}};d.style=b,f([T({rerender:!1,after:function(){this.updateText()}})],d.prototype,"scope",2);new u;if(!window.customElements)throw new Error("Custom Elements not supported");window.customElements.get("pap-translator")||window.customElements.define("pap-translator",d);export{u as Localization,m as TRANSLATION_ADDED,g as TRANSLATION_CHANGE_EVENTNAME,d as Translator};
